### ДЗ 8

Т.к. я работаю в Evrone идовольно часто меняю проекты за время курса я успел поучастовать в 2-х

1. Внутренняя ERP-система для работников Evrove. Разрабатывается около 8 лет. Тк разработчики постоянно меняются, то на перфомансом особо не следят, но есть хороший монитотриинг на Prometheus. А тк пользователи это наши коллеги можно быстро получать информацию что что-то работает не так быстро как хотелось бы.
  За время работы на этом проекте я сделал:
    - настроил `local-production` окружение для 4 самых необходимых микросервисов (auth, core, ns(уведомления))
    - с помощью `WebPageTest` проанализировал некоторые страницы на которые было больше всего жалоб. Из отчета стало видно что отдаются картинки которые даже не обрезаны под размер и слишком много лишнего CSS, конкретных цифр сейчас уже не вспомню. Добавил в ci тесты на размер картинок и css. Сейчас ПР слит в develop и фронтендеры борятся с проблемой (может уже закончили я давно не проверял)
    - оптимизировал один роут апи. Пользователи жаловались, что один из роутов очень долго отвечает (чем дольше работает сотрудник тем больше время ответа).
    Нашел в БД пользователя который работает дольше всех. За метрику выбрал время ответа
    Произвел замер для него получил около 10 секунд в local-production откружении.
      - `bullet` нашел N+1 запросы, убрав которые ускорил ответ до 3-4 секунд (easy win)
      - Oтчет `flat` показал что время уходит на генерацию ответа json. В ответе большую часть занимал поле `Ability`
      - Заменил сериалайзер на `alba`, уверяли что он самый быстрый и использует внутри себя `Oj`. Время ответа уменьшилось до 2,5-3 сек. 
      - Так жерешили что `Ability` для пользователя меняется не так часто и решили кэшировать его в redis.
      - Сделал ПР со своими изменениямии и зачел отдельную задачу на добевление кэширования.
      - Сейчас это все в продакшене, на скорость ответа больше не ругаются. Приняли решение отказаться от старых сериалайзеров в пользу `alba`

2. Финтех. Сервис по выдаче потребительских кредитов. Пишется около 5 лет. Мониторинг в Datadog, ошибки в Sentry. За перфомансом не следят. Я попал в новую команду которая не занимается бизнес задачами, а наводит в сервисе порядом (рефакторингом, вынесением в микросерсивы и тд)
  За 2 недели которые этим занимаюсь:
    - сделал окружение `local-production`
    - Показал отличие в скорости между `ruby-2.5` и `ruby-2.7`. Решили постепенно поднимать версию (сейчас уже подняли с 2.5.3 до 2.5.9) и версию rails до максимально возможной 5.1.
    - Исправил файлы Docker и docker-compose, написал Makefile и исправил документацию так чтобы проект разворачивался одной командой `make app-setup`. Сейчас ветка в тестах, находятся всякие мелкие ошибки и недочеты, которые я правлю. 
    - Немного переработал CI: добавил линтеры для JS, исправил правила для rubocop, сделал `fail fast`, теперь линтеры проверяются еще до билда и падают в случае ошибки.
    - Сейчас занимаюсь ускорением тестов. Было локально за очень долго в один поток, ждал около 40 минут так и не дождался конца. Сейчас запусаются в `circle` в 5 потоков и проходят за ~20 минут. Выиграл немного скорости за счет отключения `database_cleaner`. Продолжаю разбираться с помощью `test_prof`.